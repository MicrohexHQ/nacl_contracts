# -*- python -*-

Import('env')

read_ledger_srpc_libs = ['srpc', 'platform', 'gio', 'imc', 'imc_syscalls']

read_ledger_srpc_obj = env.ComponentObject('read_ledger_srpc.o', 'read_ledger_srpc.c')
read_ledger_srpc_nexe_name = 'read_ledger_srpc%s' % env.get('TARGET_FULLARCH')
read_ledger_srpc_nexe = env.ComponentProgram(read_ledger_srpc_nexe_name,
                                             read_ledger_srpc_obj,
                                             EXTRA_LIBS=read_ledger_srpc_libs + [
                                              '${PTHREAD_LIBS}'])

env.Publish(read_ledger_srpc_nexe_name, 'run',
            ['read_ledger_srpc.html',
             'read_ledger_srpc_data.html'])

read_ledger_srpc_nonbrowser = env.ComponentProgram('read_ledger_srpc_nonbrowser',
                                           read_ledger_srpc_obj,
                                           EXTRA_LIBS=read_ledger_srpc_libs + [
                                               '${PTHREAD_LIBS}',
                                               '${NONIRT_LIBS}'])

node = env.SelUniversalTest(
    'read_ledger_srpc_test.out',
    read_ledger_srpc_nonbrowser,
    stdout_golden=env.File('read_ledger_srpc_test.stdout'),
    )
env.AddNodeToTestSuite(node,
                       ['small_tests'],
                       'run_read_ledger_srpc_test')
